const ExcelReader = require('node-excel-stream').ExcelReader;
const fs = require('fs');

let huNumbers=[
    "118082000017",
    "118082000018",
    "118082000019",
    "118082000020",
    "118082000021",
    "118082000022",
    "118082000023",
    "118082000024",
    "118082000025",
    "118082000026",
    "118082000027",
    "118082000028",
    "118082000029",
    "118082000030",
    "118082000031",
    "118082000032",
    "118082000033",
    "118082000034",
    "118082000035",
    "118082000036",
    "118082000037",
    "118082000038",
    "118082000039",
    "118082000040",
    "118082000041",
    "118082000042",
    "118082000043",
    "118082000044",
    "118082000045",
    "118082000046",
    "118082000047",
    "118082000048",
    "118082000049",
    "118082000050",
    "118082000051",
    "118082000052",
    "118082000053",
    "118082000054",
    "118082000055",
    "118082000056",
    "118082000057",
    "118082000058",
    "118082000059",
    "118082000060",
    "118082000061",
    "118082000062",
    "118082000063",
    "118082000064",
    "118082000065",
    "118082000066",
    "118082000067",
    "118082000068",
    "118082000069",
    "118082000070",
    "118082000071",
    "118082000072",
    "118082000073",
    "118082000074",
    "118082000075",
    "118082000076",
    "118082000077",
    "118082000078",
    "118082000079",
    "118082000080",
    "118082000081",
    "118082000082",
    "118082000083",
    "118082000084",
    "118082000085",
    "118082000086",
    "118082000087",
    "118082000088",
    "118082000089",
    "118082000090",
    "118082000091",
    "118082000092",
    "118082000093",
    "118082000094",
    "118082000095",
    "118082000096",
    "118082000097",
    "118082000098",
    "118082000099",
    "118082000100",
    "118082000101",
    "118082000102",
    "118082000103",
    "118082000104",
    "118082000105",
    "118082000106",
    "118082000107",
    "118082000108",
    "118082000109",
    "118082000110",
    "118082000111",
    "118082000112",
    "118082000113",
    "118082000114",
    "118082000115",
    "118082000116",
    "118082000117",
    "118082000118",
    "118082000119",
    "118082000120",
    "118082000121",
    "118082000122",
    "118082000123",
    "118082000124",
    "118082000125",
    "118082000126",
    "118082000127",
    "118082000128",
    "118082000129",
    "118082000130",
    "118082000131"
]

let info = {
    "DONumber":"0800546203",
    "PackedBy":"store-outgoing-sg",
    "PackedOn":"20180820 18:45:00"
}

let huIdx=-1;
var BC = require('./../web/js/services/barcode');
let barcode = new BC();
let sqlscript;


let dataStream = fs.createReadStream('./output/Scanning file for BX upload 20082018a.xlsx');
let reader = new ExcelReader(dataStream, {
    sheets: [{
        name: 'Quarantine',
        rows: {
            headerRow: 1,
            allowedHeaders: [
                {name: 'Scan',key: 'Scan'} 
                ,{name: 'No',key: 'No'}
                ,{name: 'HU',key: 'HU'}
            ]
        }
    },{
        name: 'Overall',
        rows: {
            headerRow: 1,
            allowedHeaders: [
                {name: 'Scan',key: 'Scan'} 
                ,{name: 'No',key: 'No'}
            ]
        }
    }]
})
reader.eachRow(function(row, rowNum, sheetSchema) {
    // console.log("Insert into dbo.SAP_EANCodes values('"+rowData.EAN+"','"+rowData.material+"',"+rowData.convertUnit+")");
    // console.log(row.scan+"--"+row.carton);
    if (row.HU){
        huIdx++;
        // console.log("huIdx:"+huIdx+", carton:"+row.carton);
    }
    barcode.reset();
    if (row.Scan){
        barcode.barcode1=row.Scan;
        barcode.parseBarcode();
        sqlscript=[
            "exec dbo.InsertOrUpdatePacking",
            "'"+info.DONumber+"',",
            "'"+barcode.eanCode+"',",
            "'"+huNumbers[huIdx]+"',",
            "Null,",
            "'"+barcode.batchNo+"',",
            "Null,",
            "'"+((barcode.serialNo)||"Null")+"',",
            "'"+info.PackedBy+"',",
            "'"+info.PackedOn+"',",
            "'"+1+"',",
            "'"+barcode.barcode1+"',",
            1
        ] 
        console.log(sqlscript.join(" "));       
    }
})
.then(function() {
    // console.log('done parsing');
});
